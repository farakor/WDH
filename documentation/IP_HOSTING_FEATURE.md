# Информация об IP-адресе и хостинге сайтов

## Обзор

Добавлена новая функция для автоматического определения и отображения IP-адреса и хостинг-провайдера для каждого отслеживаемого сайта.

## Изменения

### Backend

#### 1. База данных (schema.prisma)

Добавлены два новых поля в модель `Website`:

- `ipAddress` (String?) - IP-адрес сайта
- `hosting` (String?) - Название хостинг-провайдера

```sql
ALTER TABLE websites
ADD COLUMN "ipAddress" TEXT,
ADD COLUMN hosting TEXT;
```

#### 2. Новый сервис: `ip.service.ts`

Создан новый сервис для получения информации об IP и хостинге:

**Методы:**

- `getIPAddress(url: string)` - Получает IP-адрес домена через DNS lookup
- `getHostingInfo(ip: string)` - Получает информацию о хостинге через ip-api.com API
- `getIPAndHosting(url: string)` - Комплексный метод получения обеих данных

**API для получения информации о хостинге:**

- Используется бесплатный API: http://ip-api.com/json/{ip}
- Лимит: 45 запросов в минуту
- Возвращает: organization, ISP, AS number

#### 3. Обновленный `monitoring.service.ts`

- При проверке сайта автоматически обновляется IP и хостинг информация
- Обновление происходит если:
  - Информация отсутствует
  - Данные старше 24 часов

#### 4. Обновленный `website.controller.ts`

- При создании нового сайта автоматически получается IP и хостинг
- При обновлении URL сайта информация обновляется автоматически

### Frontend

#### 1. Типы (types/index.ts)

Обновлен интерфейс `Website`:

```typescript
interface Website {
  // ... существующие поля
  ipAddress?: string | null;
  hosting?: string | null;
}
```

#### 2. WebsiteDetailPage

Добавлена секция с отображением:

- IP-адрес с иконкой Globe
- Хостинг-провайдер с иконкой Server
- Карточки в адаптивном grid layout (1 колонка на мобильных, 2 на десктопе)

#### 3. DashboardPage

В карточках списка сайтов:

- Добавлена отдельная секция с IP и хостингом между основной информацией и статистикой
- Отображение с иконками Globe и Server
- Компактный формат для экономии места

#### 4. WebsitesPage

В таблице списка сайтов:

- **Отдельная колонка "IP / Хостинг"** в таблице
- IP-адрес (с иконкой Globe, моноширинный шрифт)
- Хостинг-провайдер (с иконкой Server, с обрезкой длинных названий)
- Прочерки (—) для сайтов без данных

## Как это работает

### Получение IP-адреса

1. Извлекается hostname из URL
2. Выполняется DNS lookup через Node.js модуль `dns`
3. Возвращается IPv4 адрес

### Получение информации о хостинге

1. По IP-адресу делается запрос к API ip-api.com
2. Извлекается наиболее информативное значение (organization > ISP > AS)
3. Информация сохраняется в базу данных

### Автоматическое обновление

- **При создании сайта**: Информация получается сразу
- **При изменении URL**: Информация обновляется автоматически
- **При мониторинге**: Обновляется раз в 24 часа

## Примеры отображения

### На странице деталей сайта:

```
┌─────────────────────────────────────┐
│ IP адрес           Хостинг          │
│ 🌐 142.250.185.78  🖥️ Google LLC    │
└─────────────────────────────────────┘
```

### В списке сайтов (таблица):

```
┌─────────────────────┬───────────────────────────┬──────────┐
│ Сайт                │ IP / Хостинг              │ Статус   │
├─────────────────────┼───────────────────────────┼──────────┤
│ My Website          │ 🌐 93.184.216.34          │ ✓ Онлайн │
│ https://example.com │ 🖥️ Edgecast Inc.          │          │
└─────────────────────┴───────────────────────────┴──────────┘
```

### На Dashboard (карточки):

```
┌─────────────────────────────────────────────────────────────┐
│ My Website  [✓ Онлайн]                                      │
│ https://example.com                                          │
│                                                              │
│ 🌐 93.184.216.34        ⏱️ 250ms                            │
│ 🖥️ Edgecast Inc.        🕐 12:30:45                         │
└─────────────────────────────────────────────────────────────┘
```

## Технические детали

### Зависимости

- Node.js `dns` module (встроенный)
- `axios` для HTTP запросов к API
- `promisify` для работы с DNS в async/await стиле

### Обработка ошибок

- Если не удается получить IP - возвращается `null`
- Если API недоступен - возвращается `null`
- Все ошибки логируются в консоль

### Производительность

- DNS lookup: очень быстро (<100ms)
- API запрос: ~200-500ms
- Кэширование: 24 часа в базе данных
- Лимит API: 45 запросов/минуту (достаточно для большинства случаев)

## Будущие улучшения

Потенциальные улучшения:

1. Добавить кэш в Redis для более быстрого доступа
2. Использовать платный API для большей надежности
3. Добавить geolocation информацию (страна, город)
4. Показывать историю изменений IP
5. Отправлять уведомления при смене IP-адреса
